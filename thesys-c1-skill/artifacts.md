# Artifacts

Artifacts are structured, document-style content that C1 can generate—reports, presentations, slideshows. They can be standalone or generated within conversations.

---

## Overview

### What Are Artifacts?

Artifacts are rich documents generated by C1:
- Business reports from conversations
- Slide presentations from data
- Documents that can be edited iteratively

### Workflow

1. **Generate**: Send prompt to Artifacts API endpoint
2. **Render & Stream**: Display with `<C1Component>`, streaming in real-time
3. **Edit**: Send existing content + edit instructions for refinement

### Artifact API Endpoint

```
POST https://api.thesys.dev/v1/artifact/chat/completions
```

Model: `c1/artifact/v-20251230`

---

## Generating Artifacts

### Basic Generation

```typescript
import OpenAI from "openai";

const client = new OpenAI({
  baseURL: "https://api.thesys.dev/v1/artifact",
  apiKey: process.env.THESYS_API_KEY,
});

const response = await client.chat.completions.create({
  model: "c1/artifact/v-20251230",
  messages: [
    { role: "user", content: "Create a presentation about Q4 sales results" }
  ],
  metadata: {
    thesys: JSON.stringify({
      c1_artifact_type: "slides",  // "slides" or "report"
      id: "unique-artifact-id",     // Unique identifier
    }),
  },
  stream: true,
});
```

### Artifact Types

- `slides`: Slide presentations
- `report`: Business reports/documents

---

## Rendering & Streaming Artifacts

### Frontend-Backend Flow

```
Frontend → Your Backend → C1 Artifact API
                      ← Streams content
         ← Forwards stream
```

> **Important**: Never call C1 API directly from frontend—keep API keys secure on backend.

### Rendering Static Artifacts

```tsx
async function fetchStaticArtifact() {
  setIsLoading(true);
  try {
    const response = await fetch("/api/generate-slides", { method: "POST" });
    const data = await response.json();
    setC1Response(data.content);
  } catch (error) {
    console.error("Error:", error);
  } finally {
    setIsLoading(false);
  }
}
```

### Rendering Streamed Artifacts (Recommended)

```tsx
import { useState } from "react";
import { C1Component, ThemeProvider } from "@thesysai/genui-sdk";

function ArtifactViewer() {
  const [c1Response, setC1Response] = useState("");
  const [isLoading, setIsLoading] = useState(false);

  const generateArtifact = async () => {
    setIsLoading(true);
    setC1Response("");

    try {
      const response = await fetch("/api/generate-artifact", { method: "POST" });
      
      if (!response.body) throw new Error("Response body is empty.");
      
      const reader = response.body.getReader();
      const decoder = new TextDecoder();
      let accumulated = "";

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        
        accumulated += decoder.decode(value);
        setC1Response(accumulated);
      }
    } catch (error) {
      console.error("Error:", error);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <ThemeProvider>
      <button onClick={generateArtifact} disabled={isLoading}>
        {isLoading ? "Generating..." : "Generate Artifact"}
      </button>
      <C1Component
        c1Response={c1Response}
        isStreaming={isLoading}
      />
    </ThemeProvider>
  );
}
```

---

## Editing Artifacts

Edit artifacts by sending existing content + new instructions:

### API Call Structure

```typescript
import OpenAI from "openai";

const client = new OpenAI({
  baseURL: "https://api.thesys.dev/v1/artifact",
  apiKey: process.env.THESYS_API_KEY,
});

const updatedArtifact = await client.chat.completions.create({
  model: "c1/artifact/v-20251230",
  messages: [
    // 1. Existing artifact as assistant message
    {
      role: "assistant",
      content: existingArtifactContent,
    },
    // 2. Edit instructions as user message
    {
      role: "user",
      content: "Add a new slide summarizing key takeaways.",
    },
  ],
  metadata: {
    thesys: JSON.stringify({
      c1_artifact_type: "slides",
      id: "unique-artifact-id",  // Same ID as original
    }),
  },
});
```

### Full Edit Endpoint Example

```typescript
// app/api/edit-slides/route.ts
import { NextRequest, NextResponse } from "next/server";
import OpenAI from "openai";

const client = new OpenAI({
  baseURL: "https://api.thesys.dev/v1/artifact",
  apiKey: process.env.THESYS_API_KEY,
});

export async function POST(req: NextRequest) {
  const { existingArtifactContent, editPrompt, artifactId } = await req.json();

  const updatedArtifact = await client.chat.completions.create({
    model: "c1/artifact/v-20251230",
    messages: [
      { role: "assistant", content: existingArtifactContent },
      { role: "user", content: editPrompt },
    ],
    metadata: {
      thesys: JSON.stringify({
        c1_artifact_type: "slides",
        id: artifactId,
      }),
    },
  });

  return NextResponse.json({
    content: updatedArtifact.choices[0].message.content,
  });
}
```

---

## Exporting Artifacts to PDF

### PDF Export API

```
POST https://api.thesys.dev/v1/artifact/pdf/export
```

### Backend Endpoint

```typescript
// app/api/export-pdf/route.ts
import { NextRequest, NextResponse } from "next/server";

export async function POST(req: NextRequest) {
  const { exportParams } = await req.json();

  try {
    const pdfResponse = await fetch("https://api.thesys.dev/v1/artifact/pdf/export", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${process.env.THESYS_API_KEY}`,
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ exportParams }),
    });

    if (!pdfResponse.ok) {
      throw new Error(`Failed: ${pdfResponse.statusText}`);
    }

    return new NextResponse(pdfResponse.body, {
      headers: {
        "Content-Type": "application/pdf",
        "Content-Disposition": 'attachment; filename="artifact.pdf"',
      },
    });
  } catch (error) {
    const message = error instanceof Error ? error.message : "Unknown error";
    return NextResponse.json({ error: message }, { status: 500 });
  }
}
```

### Frontend Handler

```tsx
const handleExport = async ({ exportParams, title }) => {
  try {
    const response = await fetch("/api/export-pdf", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ exportParams }),
    });

    if (!response.ok) throw new Error("Failed to download PDF.");

    const blob = await response.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `${(title || "artifact").replace(/\.pdf$/i, "")}.pdf`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    a.remove();
  } catch (error) {
    console.error("Export failed:", error);
  }
};

// Usage with C1Component
<C1Component
  c1Response={c1Response}
  exportAsPdf={handleExport}
/>

// Usage with C1Chat
<C1Chat
  apiUrl="/api/chat"
  customizeC1={{
    exportAsPdf: handleExport,
  }}
/>
```

---

## Artifacts in Conversations

Generate and edit artifacts within a chat using tool calls.

### Define Create Tool

```typescript
import { z } from "zod";
import { zodToJsonSchema } from "zod-to-json-schema";

const createPresentationTool = {
  type: "function",
  function: {
    name: "create_presentation",
    description: "Creates a slide presentation based on a topic.",
    parameters: zodToJsonSchema(
      z.object({
        instructions: z.string().describe("Instructions to generate the presentation."),
      })
    ),
  },
};
```

### Handle Tool Call

```typescript
import { nanoid } from "nanoid";
import { makeC1Response } from "@thesysai/genui-sdk/server";

async function handleCreatePresentation(
  { instructions },
  { messageId, c1Response }
) {
  const artifactId = nanoid();

  // Create client for Artifacts API
  const artifactsClient = new OpenAI({
    baseURL: "https://api.thesys.dev/v1/artifact",
    apiKey: process.env.THESYS_API_KEY,
  });

  // Generate artifact
  const artifactStream = await artifactsClient.chat.completions.create({
    model: "c1/artifact/v-20251230",
    messages: [{ role: "user", content: instructions }],
    metadata: {
      thesys: JSON.stringify({
        c1_artifact_type: "slides",
        id: artifactId,
      }),
    },
    stream: true,
  });

  // Stream artifact content
  for await (const delta of artifactStream) {
    const content = delta.choices[0]?.delta?.content;
    if (content) {
      c1Response.writeContent(content);
    }
  }

  // Return result for LLM
  return `Presentation created with artifact_id: ${artifactId}, version: ${messageId}`;
}
```

### Full API Route with Artifacts

```typescript
// app/api/chat/route.ts
import { NextRequest, NextResponse } from "next/server";
import OpenAI from "openai";
import { makeC1Response } from "@thesysai/genui-sdk/server";

const embedClient = new OpenAI({
  baseURL: "https://api.thesys.dev/v1/embed",
  apiKey: process.env.THESYS_API_KEY,
});

const artifactClient = new OpenAI({
  baseURL: "https://api.thesys.dev/v1/artifact",
  apiKey: process.env.THESYS_API_KEY,
});

export async function POST(req: NextRequest) {
  const c1Response = makeC1Response();
  const { prompt, threadId, responseId } = await req.json();

  const llmStream = await embedClient.beta.chat.completions.runTools({
    model: "c1/anthropic/claude-sonnet-4/v-20251230",
    messages: [{ role: "user", content: prompt }],
    stream: true,
    tools: [
      {
        type: "function",
        function: {
          name: "create_presentation",
          description: "Creates a slide presentation.",
          parameters: { type: "object", properties: { instructions: { type: "string" } } },
          function: async ({ instructions }) => {
            const artifactId = crypto.randomUUID();
            
            const stream = await artifactClient.chat.completions.create({
              model: "c1/artifact/v-20251230",
              messages: [{ role: "user", content: instructions }],
              metadata: { thesys: JSON.stringify({ c1_artifact_type: "slides", id: artifactId }) },
              stream: true,
            });
            
            for await (const chunk of stream) {
              const content = chunk.choices[0]?.delta?.content;
              if (content) c1Response.writeContent(content);
            }
            
            return `Created artifact: ${artifactId}`;
          },
        },
      },
    ],
  });

  llmStream.on("content", (content) => c1Response.writeContent(content));
  llmStream.on("end", () => c1Response.end());

  return new NextResponse(c1Response.responseStream, {
    headers: {
      "Content-Type": "text/event-stream",
      "Cache-Control": "no-cache, no-transform",
      Connection: "keep-alive",
    },
  });
}
```

---

## Complete Example

A full artifacts-in-chat example is available at:
https://github.com/thesysdev/examples/tree/main/c1-chat-artifact

### Key Concepts

1. **Artifact ID**: Unique identifier for each artifact
2. **Version**: Use `messageId` as version to link artifact to message
3. **Edit Loop**: Send existing content + instructions to modify
4. **Streaming**: Always stream for best UX
